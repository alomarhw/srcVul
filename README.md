# srcVul
**srcVul: A Slicing-Based Approach for Detecting and Patching Vulnerable Code Clones**

The `srcVul` system is designed to identify security vulnerabilities in code clones using a methodical three-stage process. It focuses on extracting non-contiguous, re-ordered, and intertwined statements related to vulnerabilities (𝑉 𝑅𝑠𝑡𝑚𝑡𝑠) from well-documented vulnerable programs and their corresponding patches for specific known vulnerabilities. This process includes:

1. **Slicing and Comparison**:  
   The vulnerable program and its associated patch are subjected to slicing and comparison. This stage is crucial in generating a list of vulnerability-related slices (𝑉 𝑅𝑠𝑙𝑖𝑐𝑒𝑠) that contain 𝑉 𝑅𝑠𝑡𝑚𝑡𝑠.

2. **Cloning Detection**:  
   The 𝑉 𝑅𝑠𝑙𝑖𝑐𝑒𝑠, obtained from the previous stage, are systematically compared to pinpoint their clones within slices of the target program.

To achieve this, `srcVul` leverages the capabilities of:
- [srcML](https://www.srcml.org)
- [srcSlice](https://www.srcml.org/tools.html)  

Additionally, the source code of `srcSlice` can be accessed on GitHub: [https://github.com/srcML/srcSlice](https://github.com/srcML/srcSlice).

---

## Detailed Steps for Generating Slicing Vectors and Finding Vulnerabilities

### Convert the Source Code to srcML Representation

1. **Download srcML**:  
   - Install srcML from the official website: [https://www.srcml.org](https://www.srcml.org).  
   - Installation instructions are available at: [https://www.srcml.org/#download](https://www.srcml.org/#download).

2. **Convert Source Code to XML using srcML**:  
   a. Once srcML is installed, you can convert your source code into an XML representation that preserves the code’s syntax information.  
   b. **For Linux or macOS**:  
      ```bash
      ~/srcML/build/bin/srcml 'input_code_file_or_archive_url' > 'output_file' --position
      ```  
   c. **For Windows** (Run in PowerShell as Administrator):  
      ```powershell
      & 'path_to_srcML\srcml.exe' 'input_code_file_or_archive_url' > 'output_file.xml' --position
      ```  
   d. Replace `input_code_file_or_archive_url` with the file name or URL of the code you want to analyze.  
   e. Replace `output_file` with the name of the file where you want to save the srcML output.  
   f. The `--position` option is crucial for including position information for identifiers.  

   - The output file generated by srcML will be in XML format. It contains structured information about your source code, including the syntax tree, code elements, and their positions. This XML enables `srcSlice` to analyze the code effectively.

---

### Download and Run srcSlice

1. **If you are using Linux**:  
   a. Visit [https://www.srcml.org/tools.html](https://www.srcml.org/tools.html) and download srcSlice.  
   b. Run srcSlice:  
      ```bash
      ./srcSlice "name of the srcML archive"
      ```  
   c. **System Dictionary Creation**:  
      srcSlice generates a system dictionary containing detailed slice profiles, including:
      - Definitions (def)
      - Uses (use)
      - Dependent Variables (dvars)
      - Pointers (ptrs)
      - Called Functions (cfuncs)  
   d. **Refer to Tutorials**:  
      For a comprehensive understanding of the slicing results and how to interpret them, refer to this [YouTube tutorial](https://www.youtube.com/watch?v=fk9JiIi032U&t=80s).

2. **If you are using Windows (via WSL)**:  
   a. Install WSL (Windows Subsystem for Linux):  
      Open PowerShell as Administrator and run:
      ```powershell
      wsl --install
      ```
      By default, Ubuntu will be installed.  
   b. Launch Ubuntu (WSL):  
      Open the Ubuntu terminal from your Start menu after installation and create a new user.  
   c. Download srcSlice:  
      - Visit [https://www.srcml.org/tools.html](https://www.srcml.org/tools.html) and download the srcSlice tool (e.g., `srcslice-ubuntu-14.04.tar.gz`).  
      - Place the file in a directory accessible to WSL (e.g., `C:\Users\YourUsername\Downloads`).  
   d. Extract the srcSlice Archive:  
      ```bash
      cd /mnt/c/Users/YourUsername/Downloads
      tar -xvzf srcslice-ubuntu-14.04.tar.gz
      cd srcslice-ubuntu-14.04
      chmod +x srcslice-ubuntu-14
      ```
   e. Run srcSlice:  
      ```bash
      ./srcslice-ubuntu-14 your-srcML-file.xml
      ```  
   f. **System Dictionary Creation**:  
      srcSlice generates a system dictionary containing detailed slice profiles, including:
      - Definitions (def)
      - Uses (use)
      - Dependent Variables (dvars)
      - Pointers (ptrs)
      - Called Functions (cfuncs)

---

### Calculate Slice-based Metrics and Generate Slicing Vectors

#### Explanation of Slice-based Metrics

1. **Slice Count (SC)**:  
   This metric quantifies the number of slices in relation to the module size.  
   - For variables: `SC (var) = Slice_Profile (SP) / Module_Size`, where `SP (var) = (1 + DVars.Count + Ptrs.Count)`.  
   - For functions: Represents the total count of slices encompassing all variables within the function.  
   - For files: Corresponds to the count of slices associated with functions in that file.  

2. **Slice Size (SZ)**:  
   This metric represents the total number of statements within a complete final slice.  
   Mathematically:  
	SZ (var) = (def(var) ∪ use(var)).Count

3. **Slice Coverage (SCvg)**:  
SCvg measures the slice size relative to the module size, quantified in lines of code (LoC).  
Mathematically:  
	SCvg = SZ / Module_Size

4. **Slice Identifier (SI)**:  
SI counts the unique identifiers, including variables and method invocations, contained within a slice.  
Mathematically:  
	SI = (DVars.Count + Ptrs.Count + CFuncs.Count) / Module_Size

5. **Slice Spatial (SS)**:  
SS represents the spatial distance in LoC between the initial definition and the ultimate use of the slicing variable.  
Mathematically:  
	SS = (Sl - Sf) / Module_Size
Where:  
- `Sf` denotes the first statement in the slice.  
- `Sl` denotes the last statement in the slice.  

## Generating Slice Vectors

You can generate the slice vectors using either the Python script or the C# solution:

- We recommend using the **Python version**, as it is easier to execute and is the most up-to-date implementation.  
  Please follow the instructions provided in the [VectorOperations_Python README](VectorOperations_Python/README.md).

- Alternatively, you can also use the **C# solution** by following the instructions provided in the [VectorOperations README](VectorOperations/README.md).

---

## TrainingDataset

The `TrainingDataset` folder contains data used for training and evaluating the system for detecting and patching vulnerabilities. It includes example snippet, it's patched version, slicing profile, and a main dataset in CSV format, as referenced in the research paper.

### Contents

- **Snippet Folder**: Contains an example snippet, it's corresponding patched code, and slicing profile related to the variable.
- **Data Folder**: Contains the main dataset in CSV format used for generating generalized results.

For detailed information, refer to the [README file in the `TrainingDataset` folder](TrainingDataset/README.md).


---

## TestingDataset

The `TestingDataset` folder contains data and snippets used for testing vulnerabilities and generating slicing profiles. It includes examples and datasets for different systems, as referenced in the paper.

### Contents
- **Snippet Folder**: Contains an example of code snippet and slice profile related to vulnerabilities.
- **Data Folder**: Contains testing data for four different systems.
- **Slices Folder**: Contains the slices for the testing systems, generated using srcSlice.

For detailed information, refer to the [README file in the `TestingDataset` folder](TestingDataset/README.md).

---

## Clone Detection Script

The `CloneDetection` folder contains a Python script for identifying and grouping vulnerabilities with similar slicing vectors using MinHash and LSH.

### Key Features:
- Detect and group CVEs with similar slicing vectors.
- Efficient processing using MinHash and Locality-Sensitive Hashing.
- Outputs clone groups and clone pairs for analysis.

For detailed information, refer to the [README in the `CloneDetection` folder](CloneDetection/README.md).

---

## Accuracy Classifier Script

The `AccuracyClassifier` folder contains a Python script for evaluating vulnerability detection performance by classifying vulnerabilities into True Positives (TP), False Positives (FP), True Negatives (TN), and False Negatives (FN) using slicing vectors.

### Key Features:
- Classifies vulnerabilities based on slicing vector similarity.
- Calculates and tracks TP, FP, TN, and FN for each detected vulnerability.
- Outputs classification metrics and the associated file IDs for each category.

For detailed information, refer to the [README in the `AccuracyClassifier` folder](AccuracyClassifier/README.md).
